"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2321],{43835:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>D});var t=e(74848),i=e(28453);const s={},a=void 0,o={id:"save this to git code reponsitories/2021-03-26",title:"2021-03-26",description:"",source:"@site/docs/save this to git code reponsitories/2021-03-26.md",sourceDirName:"save this to git code reponsitories",slug:"/save this to git code reponsitories/2021-03-26",permalink:"/docs/save this to git code reponsitories/2021-03-26",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/save this to git code reponsitories/2021-03-26.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"2021-03-26-2",permalink:"/docs/save this to git code reponsitories/2021-03-26-2"},next:{title:"2021-07-21",permalink:"/docs/save this to git code reponsitories/2021-07-21"}},l={},D=[];function d(r){const n={code:"code",pre:"pre",...(0,i.R)(),...r.components};return(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"module ASYN_FIFO #(\r\n    parameter   DATA_WIDRH  =   16,\r\n    parameter   DATA_DEPTH  =   1024,\r\n    parameter   ADDR_WIDTH  =   10\r\n)\r\n(\r\n    input                           wclk,\r\n    input                           wrst,\r\n    input                           wen,\r\n    input   [DATA_WIDRH - 1 : 0]    wData,\r\n    input                           rclk,\r\n    input                           rrst,\r\n    input                           ren,\r\n    output  [DATA_WIDRH - 1 : 0]    rData,\r\n    output  reg                     full,\r\n    output  reg                     empty\r\n);\r\nreg     [DATA_WIDRH - 1 : 0]    mem     [0 : DATA_DEPTH - 1];\r\nwire    [ADDR_WIDTH - 1 : 0]    raddr;\r\nwire    [ADDR_WIDTH - 1 : 0]    waddr;\r\nreg     [ADDR_WIDTH     : 0]    rptr, rptr_w1, rptr_w2;                 //\u7f16\u7801\u5730\u5740\u6bd4RAM\u5730\u5740\u591a\u4e00\u4f4d,\u76ee\u7684\u662f\u65b9\u4fbf\u4f7f\u7528\u683c\u96f7\u7801\u5224\u65ad\u7a7a\u6ee1\u4fe1\u53f7\r\nreg     [ADDR_WIDTH     : 0]    wptr, wptr_r1, wptr_r2;\r\nreg     [ADDR_WIDTH     : 0]    wbin, rbin;\r\nwire    [ADDR_WIDTH     : 0]    wbinnext, rbinnext, wgraycode, rgraycode;\r\nwire                            empty_val, full_val;\r\n//RAM\r\nassign raddr = rbin[ADDR_WIDTH - 1 : 0];\r\nassign waddr = wbin[ADDR_WIDTH - 1 : 0];\r\nassign rData = mem[raddr];\r\nalways @(posedge wclk) begin\r\n    if (wen & (!full))\r\n        mem[waddr] <= wData;\r\nend\r\n//address generate\r\nassign wbinnext = wbin + (wen & (!full));\r\nassign rbinnext = rbin + (ren & (!empty));\r\nassign wgraycode = (wbinnext >> 1) ^ wbinnext;\r\nassign rgraycode = (rbinnext >> 1) ^ rbinnext;\r\n\r\nalways @(posedge wclk) begin\r\n    if (wrst) begin\r\n        {wbin, wptr} <= {2*ADDR_WIDTH{1'b0}};\r\n    end\r\n    else begin\r\n        {wbin, wptr} <= {wbinnext, wgraycode};\r\n    end\r\nend\r\nalways @(posedge rclk) begin\r\n    if (rrst) begin\r\n        {rbin, rptr} <= {2*(ADDR_WIDTH+1){1'b0}};\r\n    end\r\n    else begin\r\n        {rbin, rptr} <= {rbinnext, rgraycode};\r\n    end\r\nend\r\nalways @(posedge wclk) begin\r\n    if (wrst) {rptr_w2, rptr_w1} <= {2*(ADDR_WIDTH+1){1'b0}};\r\n    else {rptr_w2, rptr_w1} <= {rptr_w1, rptr};\r\nend\r\nalways @(posedge rclk) begin\r\n    if (rrst) {wptr_r2, wptr_r1} <= {2*ADDR_WIDTH{1'b0}};\r\n    else {wptr_r2, wptr_r1} <= {wptr_r1, wptr};\r\nend\r\n//generate empty and full\r\nassign empty_val = (rgraycode == wptr_r2);\r\nassign full_val = (wgraycode == {{~rptr_w2[ADDR_WIDTH : ADDR_WIDTH - 1]}, rptr_w2[ADDR_WIDTH - 2 : 0]});\r\nalways @(posedge wclk) begin\r\n    if (wrst) full <= 1'b0;\r\n    else full <= full_val;\r\nend\r\nalways @(posedge rclk) begin\r\n    if (rrst) empty <= 1'b1;\r\n    else empty <= empty_val;\r\nend\r\nendmodule\r\n\r\nmodule ASYN_FIFO_tb (\r\n\r\n);\r\nparameter   CLK_PERIOD  =   10;\r\nparameter   RESET_HOLD  =   30;\r\nparameter   DATA_WIDTH  =   16;\r\nparameter   DATA_DEPTH  =   1024;\r\nparameter   ADDR_WIDTH  =   10;\r\n\r\nreg                             wclk;\r\nreg                             rclk;\r\nreg                             wrst;\r\nwire                            wen;\r\nreg                             rrst;\r\nreg                             ren;\r\nreg     [DATA_WIDTH - 1 : 0]    iData   =   0;\r\nwire    [DATA_WIDTH - 1 : 0]    oData;\r\nwire                            full;\r\nwire                            empty;\r\n\r\ninitial begin\r\n    rrst = 1;\r\n    wrst = 1;\r\n    # RESET_HOLD;\r\n    rrst = 0;\r\n    wrst = 0;\r\nend\r\n\r\nalways begin\r\n    wclk = 0;\r\n    #(CLK_PERIOD/2);\r\n    wclk = 1;\r\n    #(CLK_PERIOD/2);\r\nend\r\n\r\nalways begin\r\n    rclk = 0;\r\n    #(CLK_PERIOD);\r\n    rclk = 1;\r\n    #(CLK_PERIOD);\r\nend\r\n\r\nalways @(posedge wclk) begin\r\n    if (wrst) begin\r\n        ren <= 0;\r\n    end\r\n    else begin\r\n        ren <= ($random % 2);\r\n    end\r\nend\r\n\r\nalways @(posedge wclk) begin\r\n    if (wrst) begin\r\n        iData <= 16'd0;\r\n    end\r\n    else if (full) begin\r\n        iData <= iData;\r\n    end\r\n    else begin\r\n        iData <= iData + 1'b1;\r\n    end\r\nend\r\nassign wen = (!full);\r\n\r\nASYN_FIFO #(\r\n    .DATA_WIDRH(16  ),\r\n    .DATA_DEPTH(1024),\r\n    .ADDR_WIDTH(10  )\r\n)\r\nFIFO(\r\n    .wclk   (wclk   ),\r\n    .wrst   (wrst   ),\r\n    .wen    (wen    ),\r\n    .wData  (iData  ),\r\n    .rclk   (rclk   ),\r\n    .rrst   (rrst   ),\r\n    .ren    (ren    ),\r\n    .rData  (oData  ),\r\n    .full   (full   ),\r\n    .empty  (empty  )\r\n);\r\n\r\nendmodule\r\n\r\n\r\n\n"})})}function p(r={}){const{wrapper:n}={...(0,i.R)(),...r.components};return n?(0,t.jsx)(n,{...r,children:(0,t.jsx)(d,{...r})}):d(r)}},28453:(r,n,e)=>{e.d(n,{R:()=>a,x:()=>o});var t=e(96540);const i={},s=t.createContext(i);function a(r){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof r?r(n):{...n,...r}}),[n,r])}function o(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:a(r.components),t.createElement(s.Provider,{value:n},r.children)}}}]);