<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-work-log---g/2024-09-24" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">DDC C Code | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xalwayswill.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xalwayswill.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xalwayswill.github.io/docs/work-log---g/2024-09-24"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DDC C Code | My Site"><meta data-rh="true" name="description" content="Function"><meta data-rh="true" property="og:description" content="Function"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xalwayswill.github.io/docs/work-log---g/2024-09-24"><link data-rh="true" rel="alternate" href="https://xalwayswill.github.io/docs/work-log---g/2024-09-24" hreflang="en"><link data-rh="true" rel="alternate" href="https://xalwayswill.github.io/docs/work-log---g/2024-09-24" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.ce37c9a8.css">
<script src="/assets/js/runtime~main.58983a80.js" defer="defer"></script>
<script src="/assets/js/main.8555064f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/FPGA-IC/8B10B编码">FPGA-IC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/System-Verilog/Assertion">System-Verilog</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/save this to git code reponsitories/2021-01-27">save this to git code reponsitories</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/script/CSH">script</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/work-log---arm-china/2023-08-15">work-log---arm-china</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/work-log---g/2024-09-24">work-log---g</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/work-log---g/2024-09-24">DDC C Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/work-log---g/SDC相关">SDC相关</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/work-log---g/算法调试过程中的问题">算法调试过程中的问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/work-log---g/综合Flow">综合Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/work-log---g/综合问题">综合问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/work-log---g/设计问题">设计问题</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/功能安全/低功耗相关">功能安全</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/图像处理/3DLUT">图像处理</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/开发工具/Graphviz---绘制图形网络">开发工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/接口协议/CameraLink">接口协议</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/环境配置/Anaconda-配置多环境">环境配置</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/移知网课程/AMBA-APB-AHB-AXI">移知网课程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/随笔/ImageData-sv">随笔</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/面试题目记录/为什么使用与非门而不是或非 门进行逻辑面积评估？">面试题目记录</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">work-log---g</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DDC C Code</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DDC C Code</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="function">Function<a href="#function" class="hash-link" aria-label="Direct link to Function" title="Direct link to Function">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common">Common<a href="#common" class="hash-link" aria-label="Direct link to Common" title="Direct link to Common">​</a></h3>
<ul>
<li>getbits -- 获取Bitstream中的某些bit</li>
<li>ModeDeterminationDec -- 从bs中提取header的2或者3bit判断压缩格式</li>
<li>InitialCmpConfig -- 计算一些寄存器参数</li>
<li>InitialReferInfo -- 初始 化参考值，包括DICT模式下的dictionary，和Intp_1D下的aver_left_blk，两个的初始值均为 <code>1&lt;&lt;(DATA_DEPATH - 1)</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="intp_nd_dec">Intp_nD_Dec<a href="#intp_nd_dec" class="hash-link" aria-label="Direct link to Intp_nD_Dec" title="Direct link to Intp_nD_Dec">​</a></h3>
<ul>
<li>InverseQuantizationOffset -- 去量化偏移（将量化数据移位修正回去，移位加偏移，类似于分段压缩的方式）</li>
<li>InverseQuantization -- 去量化（也就是将数据移位回去，不增加偏移）</li>
<li>Division -- 几个定点触发器，可以写在一个模块里面</li>
<li>LinearInterpolation -- 对传入的端点进行插值，计算长度及每段的step，并四舍五入，左侧的参考点是通过0点加上step计算，右侧参考点坐标是通过最右侧端点减去step计算</li>
<li>InterpolationIntensification -- 9个点两两插值插出其余8个点，对应文档</li>
<li>excel文档密码</li>
<li>Intp_nD_Dec -- nD解压缩，nD理解为多个plane一起压缩？？<!-- -->
<ul>
<li>从bs中读取eps，去量化，然后插值，如果是2plane且ratio为2.67，需要多插值出来7个</li>
<li>问题1：为何2plane ratio 1(2.67) 的情况下，num_intp为15，其他都为8</li>
<li>问题2：dec_info 中idx_ratio 只有单个数据，为何reg_file里面是3个数的数组</li>
<li>问题3：3 plane 下的len_eps为655， 2plane下的len_eps为77，为了从bs中读出eps</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="intp_1d_dec----1d解压缩每个plane单独解压缩">Intp_1D_Dec -- 1D解压缩，每个plane单独解压缩<a href="#intp_1d_dec----1d解压缩每个plane单独解压缩" class="hash-link" aria-label="Direct link to Intp_1D_Dec -- 1D解压缩，每个plane单独解压缩" title="Direct link to Intp_1D_Dec -- 1D解压缩，每个plane单独解压缩">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="一些参数">一些参数：<a href="#一些参数" class="hash-link" aria-label="Direct link to 一些参数：" title="Direct link to 一些参数：">​</a></h4>
<ul>
<li>msb_zero_esp1d: intp_1d模式下endpoints最高位为0的个数，从bs中读出</li>
<li>ep_len_intp_1d：intp_1d模式下endpoints的长度？固定为4</li>
<li>q_endpoints[2]: 从bs中读出的endpoint移位去量化</li>
<li>判断两个q_endpoints的大小决定其前后关系，并获得swap bit</li>
<li>aver_left_blk初始化参考值，初始值为<code>MID_VAL(1&lt;&lt;7)</code>，初始值如何更新？只在上电时候更新一次吗？</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="函数">函数<a href="#函数" class="hash-link" aria-label="Direct link to 函数" title="Direct link to 函数">​</a></h4>
<ul>
<li>DecINTP_Single_1D -- for <strong>3p-4x</strong> no segemented linear interpolation<!-- -->
<ul>
<li>大致流程，从bs中先读取msb_zero_eps1d，和endpoints0/1，对endpoints0/1根据msb_zero_eps1d去量化，然后均匀插值得到lut曲线，之后通过比较ep0/1的大小多出来一个判断swap（该bit和p0_idx0组合构成完整的p0_idx0），然后从bs中读取所有的plane，所有的index，通过BISE3得到全部的3plane*12index个index，然后再lut曲线中查表并累加aver_left_blk得到解压后的系数值</li>
<li>从bs的前面bit取出p0/1/2_idx0/1</li>
<li>从bs中取出对应的三进制编码坐标，从BISE3的LUT表中找到每个plane剩余的10个idx的值，3p-4x下一共3p*12idx</li>
<li>逐个plane逐个像素去重建系数值</li>
</ul>
</li>
<li>DecINTP_Seg_1D -- for other case（<strong>3p-3x, 2p-3.56x, 2p-2.67x</strong>）, with segemented linear interpolation<!-- -->
<ul>
<li>大致流程，从bs中先读取msb_zero_eps1d，和endpoints0/1，对endpoints0/1根据msb_zero_eps1d去量化，然后使用量化后的两个端点计算中间三个segment，得到一个五个端点的分段LUT，一共能够组合成8条线段，之后开始计算每个系数的index，通过比较ep0/1的  大小多出来一个判断swap（该bit和p0_idx0组合构成完整的p0_idx0），然后从bs中读取所有的plane，所有的index，3p-3.56x的需要BISE3查表，得到每个plane的所有index。之后再从bs中读取每个plane所选择的LUT曲线（需要注意3p-3x只有一个subblk，也就是从8条中选择一条插出所有的系数，2p每个plane都拆成两个subblk，为了提高精度，每个subblk都要选择自己的LUT曲线，也就是8中选两条分别插值），插值方法类似，找到LUT的两个端点均匀插值出更多的segment point，然后根据index去选择对应的segment point 加上aver_left_blk得到重构后的系数。</li>
<li>len_eps_idx：端点坐标的长度，除2plane的2.67倍为3（8个点？）其余都是2（4个点？）</li>
<li>num_subblk：3plane为1，2plane为2</li>
<li>subblk_w：3-p: 1x12(4x), 1x9(3x); 2-p: 1x16(3.56x), 1x12(2.67x)</li>
<li>LinearInterpolation_EndpointsSeg -- 按照文档一样的操作插出Seg0/1/2</li>
<li>GetEndPointsLUT -- 按照文档内容选择不同的线段端点</li>
<li>2/3 plane的高倍率压缩（idx_ratio==0）情况都需要查三进制表来得到segment的index，低倍率压缩不需要，可以直接从bs中读取index</li>
<li></li>
</ul>
</li>
<li>LinearInterpolation_1D -- 根据两个端点计算step，然后根据两个端点插值中间的点，里面的INTP_FRAC_NUM为3，小数部分3bit</li>
<li>GroupBoundedDec -- 二进制的lut index转成三进制或五进制的插值用的segment</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dict_dec----字典解压缩">DICT_Dec -- 字典解压缩<a href="#dict_dec----字典解压缩" class="hash-link" aria-label="Direct link to DICT_Dec -- 字典解压缩" title="Direct link to DICT_Dec -- 字典解压缩">​</a></h3>
<ul>
<li>参数<!-- -->
<ul>
<li>msb_zero_ctrs：用于center移位去量化</li>
<li>total_size: 字典的总size</li>
<li>cls_size：字典簇的size</li>
<li>refer_size：参考点的数量（参考点和cluster如何对应的 ？？？）</li>
<li>dictionary：字典，不同ch，plane有自己单的的dictionary，都需要按照最大的空间分配</li>
</ul>
</li>
<li>函数<!-- -->
<ul>
<li>GetDictSize -- 根据plane number（reg），id_submode（bs），idx_ratio（reg） 选择total_size 和 cls_size，
对应的dict_size_3p/2p为何和文档对应不上？？？以code为准</li>
<li>LookUpDictLenLUT -- 根据ld_submode，idx_center（n-ref_size=cluster_size），plane序号，压缩率选择要从bs中读取的各个plane的center的length（固定值）</li>
</ul>
</li>
<li>步骤<!-- -->
<ul>
<li>
<ol>
<li>从dictionary中按照对应的通道对应plane对应参考点取出[0,refer_size-1]范围的centers，同时按照len_center从bs中取出对应的[refer_size, total_size-1]范围的center值并根据len_center对center值移位去量化，每个plane的total_size都是一致的，每个plane都有total_size个center值（也就是说dictionary中存放前refer_size个centers，后面的centers存放在bs中，一共total size个centers）</li>
</ol>
</li>
<li>
<ol start="2">
<li>根据id_submode和plane number按照不同的分支从bs中取index值，4x一共12个index(12x3x8/72)，3x 9个（9x3x8/72），3.56x9(16x2x8/72)个，2.67x12(12x2x8/72)个</li>
</ol>
</li>
<li>
<ol start="3">
<li>根据bs中取出的index值进行重建系数，如果index小于refer_size，直接用对应index的center值(可以理解为在字典中找到了该系数值)，如果index大于等于refer_size（字典中不存在该系数值，需要重构），则需要将根据index选择的center值和对应通道对应plane的aver_left_blk相加</li>
</ol>
</li>
<li>
<ol start="4">
<li>将当前bs的index/refer_size/cls_size记录下来，并计算cluster_center，如果refer_size小于等于1，cluster_center不更新，否则更新每个cluster的center值cls_ctr，新的值为centers[ref_size+n][p]+aver_level</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>UpdateReferInfo -- 更新参考信息（看起来后面一个bs会用到前面一个bs更新后的ReferInfo，这样很难pipe起来，performance会下降很多，好在多个颜色通道之间是相互独立的，只能通过多个通道顺序执行去提高系统性能）</p>
<p>UpdateAverInfo -- 更新aver_left_blk</p>
<ul>
<li>根据当前重构后的系数计算均值得到每个通道每个plane新的aver_left_blk</li>
</ul>
<p>UpdateDictInfo -- 更新字典，根据dec_info，refer_info，寄存器配置，bs解析出来的压缩模式更新字典</p>
<ul>
<li>dictionary每个通道每个plane的index0都为更新后的aver_left_blk</li>
<li>如果是INTP_1D或者INTP_nD，根据block_dc_w调换除index0以外的字典顺序，1至block_dc_w由重建后的系数值替代，block_dc_w+1至MAX_DICT_SIZE的系数由原来的dictionary右移block_dc_w得到</li>
<li>如果是DICT_DEC且<code>refer_size &lt;= 1</code>，根据cls_size去调整字典顺序，cls_size右侧的通过之前的dictionary右移cls_size得到，cls_size左侧（不包括index0）的用新的cluster_center进行更新</li>
<li>如果是DICT_DEC且refer_size &gt; 1，分别取block_dc_w-4到block_dc_w-2 的index值，搜索从当前值到block_dc_w-1的index，判断是否相等（表示最右侧4个点有没有命中同一点的？？），记录下第一个match的坐标(这个好像没有用，单纯是标记了hit，还好后面有个break，不然我都不知道怎么实现)，并标记hit_match</li>
<li>从[block_dc_w-4, block_dc_w-1]（重建后的最右侧4个系数），需要分别计算对应每个i的cnt，展开循环，如果index为0或者&gt;=了refer_size（说明没有hit到字典中[1,ref_size-1]的参考点，但是hit到了最左侧或者bs中的点？？），字典[1,31]的delta_idx全部加1，否则（完全没有hit到？？），从[1,index-1]的所有delta_idx加1（先对一个i循环拆分，拆分成多个delta_idx[MAX_DIC_SIZE-1,0][0,3]，对每个delta_idx[MAX_DIC_SIZE-1,0]的累加条件进行拆分，等于拆分开下面的循环和if分支，需要梳理下每个delta_idx的加1条件  ，最后将4个delta_idx相加得到总的偏移量，这循环真的费劲），cnt也需要根据hit_new计算所有i的，然后使用最后一个i的cnt（cnt最大范围也就是5），shoot的计算比较麻烦，需要计算出所有i的cnt之后，判断几个cnt之间的关系。</li>
<li>797-817：对for循环展开，每个循环自己的shoot，cnt（对于每个循环而言，应该只是标记下1bit，shoot和cnt都按照最大的循环次数声明，不要按照算法的计算步骤），同时计算delta_idx，这里的delta_idx和shoot，cnt的计算没有关联，可以独立，并且因为block_dc_w-1位置固定标记为false，所有后续cnt的判断会把index0剔除掉，且shoot[0]固定为block_dc_w</li>
<li>817-824：借用上面的循环，在内部对每一个循环的delta_idx进行更新，当shoot标记的坐标（shoot取值index从1开始的）小于refer_size（表示当前center在dictionary内部），将当前元素向左移动</li>
<li>797-824对于delta_idx的判断逻辑应该能合并起来，后面需要整理下</li>
<li>根据cnt的最大值5去展开循环，来对delta_idx进行更新</li>
<li>根据delta_idx对字典进行更新得到新的index，然后对不超范围的new_index更新字典（这里只更新[2, 31]的字典值）</li>
<li>对字典[1,cnt-1]的部分，使用shoot到原字典值的重构系数更新，这部分和上面一部分是否会存在冲突？？？</li>
</ul>
<p><strong>判断block_dc_w最右侧4个点的index情况，首先剔除相同的index，然后计算cnt，cnt即为四个中不同index的数量，然后判断index的情况。如果<code>=0</code>或<code>≥refer_size</code>，表明其重建的系数不存在于refer point中，而是在aver_left或bs中，则将整个字典向右移一次；如果小于0且小于refer_size，表明字典中存在重构的系数，对该系数前面的元素向右移动一次（因为当前元素会被放在字典的开头，所以有足够高的空间给前面的元素右移不会导致元素 被覆盖，不像前面的情况需要字典所有元素都右移才不会被覆盖掉）。
四个点一共判断四次，从而一个元素最多移动四次，最少情况下block_dc_w-1对应index位置前面的元素移动一次，后面的元素不移动</strong></p>
<p>看block_dc_w最右侧四个点是否有命中相同center的，其中最右侧一个点固定设置为未命中，分为多种情况：</p>
<ol>
<li>四个点全部存在命中相同center的点，则因为最右侧点固定标记为false，所以还是会对最后一个点的index进行判断，如果为0或者大于等于ref_size（表示命中dictionary首个元素或者命中bs中元素），则字典从[1,ref_size-1]全部右移；否则，只有[1,idx-1]位置的元素会右移</li>
<li>如果四个点中有一个以上命中同一个点，对于没命中相同位置的点会进行类似上面的判断</li>
<li>如果四个点中有一个以上命中同一个点，对于没命中相同位置的点，如果其index小于refer_size（表明center在dictionary中），则将该元素左移</li>
</ol>
<p>UpdateRecBlock2Output -- 根据解压后的block转化为对应图像的系数</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/work-log---g/2024-09-24.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/work-log---arm-china/面积记录"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">面积记录</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/work-log---g/SDC相关"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SDC相关</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#function" class="table-of-contents__link toc-highlight">Function</a><ul><li><a href="#common" class="table-of-contents__link toc-highlight">Common</a></li><li><a href="#intp_nd_dec" class="table-of-contents__link toc-highlight">Intp_nD_Dec</a></li><li><a href="#intp_1d_dec----1d解压缩每个plane单独解压缩" class="table-of-contents__link toc-highlight">Intp_1D_Dec -- 1D解压缩，每个plane单独解压缩</a></li><li><a href="#dict_dec----字典解压缩" class="table-of-contents__link toc-highlight">DICT_Dec -- 字典解压缩</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>